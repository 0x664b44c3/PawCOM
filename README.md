# PawCOM - a Partyline Analog (Wired) intercom system

## Scope of this project
This projects implements a partyline analog intercom system as used in the tv and event industry for interconnecting small teams of technical staff.

The system consists of any number from 2 up of so-called beltpacks, portable intercom stations plus a central power supply.
The portable parts are interconnected by generic microphone cabling (industry standard) and is electrically compatible to ClearCom, RTS and others.
Analog circuitry was inspired by the classic ClearCom MR102 and others but has been re-engineered from the ground up to use modern components and
add a few extra features.


## PAWCOM features

- analog signal processing with digital control
  - latency free
  - compressor/limiter on mic channel
  - limiter in Rx audio path (your ears will love you)
  - digitally adjustable sidetone level
  - adjustable MIC gain
  - low background noise
- Digital volume control
- digital PTT control with both latching and push to talk mode
- switchable mic power for electred mic headsets
- stereo headphone amp
- optional line in for program audio or personal music player

- click/pop free Call function
  - automatic audible call function if call is held for a certain time


## Circuit description

The beltpack consists of six main components:

- Line receiver 
- Audio mixer and headphone Amp
- Mic preamp and Line driver
- Sidetone Adjust
- Call circuitry
- System control MCU

### Line receiver
The line receiver is based around a quad opamp TL074. One gate implements the line receiver, one gate buffers the sidetone signal, the third gate generates VCC/2 (AGND) which is used througout the line interface. The last gate is unused (connected as a voltage follower with AGND on its input).

### Sidetone circuitry
Sidetone processing is located between the mic preamp (see below) and the line driver.
The sidetone signal is taken from the output of the mic preamp after the tx switch. 
It is then routed through a digital potentiometer MAX5395 and routed through the third opamp of the TL074 were its common mode voltage is translated to AGND (V+/2),
 routed through a passive filter that tries to mimic a typical line impedance, and is then applied to the inverted input of the line receiver OPAMP.


### Mic preamp and Tx switch

The mic preamp is based around an NJM2783 integrated mic preamp that includes
both preamp, switchable gain, a compressor and a buffer amplifier. The mic preamp is powered by a +9V rail generated by a LMR64010 boost converter from the +5V bus (optional, should lower the noise figure of the NJM2783 plus provide a bit more pre-compressor headroom).
The signal is then routed through a TS5A9411 analog switch (capacitive coupling is used here to bring the common mode voltage down to 2.5V) to provide a switchable  additional -10dB pad and then goes into gate 1 of an LMV358 driving 
into the MAX5359 sidetone-digipot.

The Tx signal then goes through a NE5534 driving the signal line. A last bit of filtering is applied here to provide a roll of towards higher frequencies and then driven onto the line through coupling capacitor and a 1.5kΩ resistor.

### Audio mixer

The actual audio mixer section consists of two LMV324 quad-opamps, a DS1881 digital volume control and a NJM2762 compressor/limiter IC.

The signal from the line receiver is goes through the NJM2762 compressor/limiter
and into a TS5A9411 analog switch (line mute).
The signal is then routed through a first buffer stage (gain = 6dB)
and then mixed with the beep signal from the MCU.
This stage drives onto two passive mixers/adders formed by resistor networks
that also provide a place to insert a stereo "program audio" signal into the headphones. This sum-signal is then buffered by two more LMV324 gates and drives the two halves of the DS1881 digital volume control IC.
The output signal of this digipot is buffered once more by two further opamps connected as voltage followers and then finally goes into the headphone amplifier.

### Headphone amplifier

The headphone amplifier is based around a LM4880 stereo amplifier. Currently no
further gain is applied in this stage.
The output goes through two coupling capacitors (100µ electrolytic) and then out to the headset connector. The pins on the headset connector are also connected to ground by 22kΩ resistors to allow the circuitry to reach steady state without connected headphone. This helps to avoid loud clicks upon connection the headset.


### Call circuitry

The call circuitry consists of two parts: call driver and call detector.
The call driver is based around two transistors applying a slew-rate limited, current-limited drive to the signal line of the cable.
Call detection is accomplished by a schmitt trigger built around another gate of a LMV324 with a threshold of roughly 2.5V.


### System controller

An ATMega324PB handles all control tasks in the beltpack. It includes UI (rotary encoder, PTT and call button, a few LEDs), beep tone generation and so on.
Furthermore the uC has one ADC dedicated to monitoring the supply voltage of the beltpack to detect a mic mute pulse as used by some systems.

The digital pots are controlled using an I2C bus that also routes to the front panel (where a PCF8574 port expander takes car eof driving the LEDs and rading PTT and call button status).

## Further reading and other projects about Partyline

You may have a look at the fnordcom project that has compiled a number of schematics and information around
older clearcom intercom systems: https://github.com/pc-coholic/fnordcom
